<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sohela Sahib | à¨¸à©‹à¨¹à¨¿à¨²à¨¾ à¨¸à¨¾à¨¹à¨¿à¨¬ (à¨•à©€à¨°à¨¤à¨¨ à¨¸à©‹à¨¹à¨¿à¨²à¨¾)
</title>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Gurmukhi:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="bani-style.css">
</head>

<body>
  <!-- Header -->
  <header class="bani-header">
    <a href="indexbani.html" class="back-btn">
      <i class="fas fa-arrow-left"></i>
      <span>Back</span>
    </a>
    <h1 class="bani-title">
      <span class="bani-title__gurmukhi">à¨¸à©‹à¨¹à¨¿à¨²à¨¾ à¨¸à¨¾à¨¹à¨¿à¨¬ (à¨•à©€à¨°à¨¤à¨¨ à¨¸à©‹à¨¹à¨¿à¨²à¨¾)
</span>
      <span class="bani-title__english">Sohela Sahib</span>
    </h1>
    <button class="settings-btn" id="settingsBtn">
      <i class="fas fa-cog"></i>
    </button>
  </header>

  <!-- Display Controls -->
  <div class="bani-controls">
    <button class="control-toggle" id="toggleGurmukhi" data-active="true">
      <span>à¨—à©à¨°à¨®à©à¨–à©€</span>
    </button>
    <button class="control-toggle" id="toggleTransliteration" data-active="true">
      <span>Roman</span>
    </button>
    <button class="control-toggle" id="toggleTranslation" data-active="true">
      <span>English</span>
    </button>
    <button class="control-toggle" id="togglePunjabi" data-active="false">
      <span>à¨ªà©°à¨œà¨¾à¨¬à©€</span>
    </button>
  </div>

  <!-- Main Content -->
  <main class="bani-content">
    <!-- Loading State -->
    <div class="bani-loading" id="baniLoading">
      <div class="spinner"></div>
      <p class="loading-text">Loading Sohela Sahib...</p>
      <p class="loading-subtext">à¨¸à©‹à¨¹à¨¿à¨²à¨¾ à¨¸à¨¾à¨¹à¨¿à¨¬ (à¨•à©€à¨°à¨¤à¨¨ à¨¸à©‹à¨¹à¨¿à¨²à¨¾)
 à¨²à©‹à¨¡ à¨¹à©‹ à¨°à¨¿à¨¹à¨¾ à¨¹à©ˆ...</p>
    </div>

    <!-- Error State -->
    <div class="bani-error" id="baniError">
      <i class="fas fa-exclamation-triangle"></i>
      <p class="error-title">Failed to load Jaap Sahib</p>
      <p class="error-message" id="errorMessage"></p>
      <button class="retry-btn" id="retryBtn">
        <i class="fas fa-redo"></i> Try Again
      </button>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar" id="statsBar"></div>

    <!-- Verses Container -->
    <div class="verses-container" id="versesContainer"></div>
  </main>

  <!-- Scroll to Top Button -->
  <button class="scroll-top-btn" id="scrollTopBtn">
    <i class="fas fa-arrow-up"></i>
  </button>

 <!-- Settings Panel -->
<div class="settings-overlay" id="settingsOverlay"></div>
<div class="settings-panel" id="settingsPanel">
  <div class="settings-header">
    <h2><i class="fas fa-cog"></i> Settings</h2>
    <button class="settings-close" id="settingsClose">
      <i class="fas fa-times"></i>
    </button>
  </div>
  
  <div class="settings-content">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         FONT SIZE CONTROLS
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <!-- Gurmukhi Font Size -->
    <div class="setting-group">
      <label class="setting-label">
        <i class="fas fa-font"></i> Gurmukhi Font Size
      </label>
      <div class="setting-control">
        <button class="size-btn" data-action="decrease" data-target="gurmukhi">
          <i class="fas fa-minus"></i>
        </button>
        <span class="size-value" id="gurmukhiSize">28</span>
        <button class="size-btn" data-action="increase" data-target="gurmukhi">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- Transliteration Font Size -->
    <div class="setting-group">
      <label class="setting-label">
        <i class="fas fa-italic"></i> Transliteration Size
      </label>
      <div class="setting-control">
        <button class="size-btn" data-action="decrease" data-target="transliteration">
          <i class="fas fa-minus"></i>
        </button>
        <span class="size-value" id="transliterationSize">18</span>
        <button class="size-btn" data-action="increase" data-target="transliteration">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- Translation Font Size -->
    <div class="setting-group">
      <label class="setting-label">
        <i class="fas fa-language"></i> Translation Size
      </label>
      <div class="setting-control">
        <button class="size-btn" data-action="decrease" data-target="translation">
          <i class="fas fa-minus"></i>
        </button>
        <span class="size-value" id="translationSize">16</span>
        <button class="size-btn" data-action="increase" data-target="translation">
          <i class="fas fa-plus"></i>
        </button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         THEME SELECTION - 12 THEMES
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div class="setting-group">
      <label class="setting-label">
        <i class="fas fa-palette"></i> Theme
      </label>
      <div class="theme-options">
        <!-- Row 1 -->
        <button class="theme-btn active" data-theme="dark" title="Midnight Gold">
          <i class="fas fa-moon"></i>
          <span>Dark</span>
        </button>
        <button class="theme-btn" data-theme="light" title="Daylight">
          <i class="fas fa-sun"></i>
          <span>Light</span>
        </button>
        <button class="theme-btn" data-theme="sepia" title="Ancient Scroll">
          <i class="fas fa-scroll"></i>
          <span>Sepia</span>
        </button>
        
        <!-- Row 2 -->
        <button class="theme-btn" data-theme="deep-blue" title="Ocean Night">
          <i class="fas fa-water"></i>
          <span>Ocean</span>
        </button>
        <button class="theme-btn" data-theme="indigo" title="Mystic Purple">
          <i class="fas fa-star"></i>
          <span>Indigo</span>
        </button>
        <button class="theme-btn" data-theme="amber" title="Royal Gold">
          <i class="fas fa-crown"></i>
          <span>Amber</span>
        </button>
        
        <!-- Row 3 -->
        <button class="theme-btn" data-theme="purple" title="Spiritual Violet">
          <i class="fas fa-gem"></i>
          <span>Purple</span>
        </button>
        <button class="theme-btn" data-theme="green" title="Nature's Blessing">
          <i class="fas fa-leaf"></i>
          <span>Green</span>
        </button>
        <button class="theme-btn" data-theme="saffron" title="Khalsa Orange">
          <i class="fas fa-fire"></i>
          <span>Saffron</span>
        </button>
        
        <!-- Row 4 -->
        <button class="theme-btn" data-theme="teal" title="Sacred Waters">
          <i class="fas fa-spa"></i>
          <span>Teal</span>
        </button>
        <button class="theme-btn" data-theme="rose" title="Divine Love">
          <i class="fas fa-heart"></i>
          <span>Rose</span>
        </button>
        <button class="theme-btn" data-theme="midnight" title="Pure Darkness">
          <i class="fas fa-adjust"></i>
          <span>Midnight</span>
        </button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         LINE SPACING
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div class="setting-group">
      <label class="setting-label">
        <i class="fas fa-arrows-alt-v"></i> Line Spacing
      </label>
      <div class="spacing-options">
        <button class="spacing-btn" data-spacing="compact">
          <i class="fas fa-compress-alt"></i> Compact
        </button>
        <button class="spacing-btn active" data-spacing="normal">
          <i class="fas fa-equals"></i> Normal
        </button>
        <button class="spacing-btn" data-spacing="relaxed">
          <i class="fas fa-expand-alt"></i> Relaxed
        </button>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         RESET BUTTON
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div class="setting-group">
      <button class="reset-btn" id="resetSettings">
        <i class="fas fa-undo"></i> Reset to Defaults
      </button>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         KEYBOARD SHORTCUTS INFO
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div class="setting-group shortcuts-info">
      <label class="setting-label">
        <i class="fas fa-keyboard"></i> Keyboard Shortcuts
      </label>
      <div class="shortcuts-list">
        <div class="shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>,</kbd>
          <span>Open/Close Settings</span>
        </div>
        <div class="shortcut-item">
          <kbd>Ctrl</kbd> + <kbd>0</kbd>
          <span>Reset to Defaults</span>
        </div>
        <div class="shortcut-item">
          <kbd>Esc</kbd>
          <span>Close Panel</span>
        </div>
      </div>
    </div>

  </div>
</div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INLINE JAVASCRIPT - JAAP SAHIB LOGIC
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // BANIDB API HANDLER - JAAP SAHIB
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const API_BASE = 'https://api.banidb.com/v2';

    // Jaap Sahib Bani ID in BaniDB
    const JAAP_SAHIB_BANI_ID = 23;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DOM ELEMENTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const baniLoading = document.getElementById('baniLoading');
    const baniError = document.getElementById('baniError');
    const errorMessage = document.getElementById('errorMessage');
    const versesContainer = document.getElementById('versesContainer');
    const statsBar = document.getElementById('statsBar');
    const retryBtn = document.getElementById('retryBtn');
    const scrollTopBtn = document.getElementById('scrollTopBtn');

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DISPLAY STATE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    let showGurmukhi = true;
    let showTransliteration = true;
    let showTranslation = true;
    let showPunjabi = false;

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ESCAPE HTML (Security)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FETCH COMPLETE JAAP SAHIB USING BANI ENDPOINT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    async function loadBani() {
      // Reset UI state
      baniLoading.style.display = 'flex';
      baniError.style.display = 'none';
      versesContainer.classList.remove('visible');
      statsBar.classList.remove('visible');
      versesContainer.innerHTML = '';

      try {
        const url = `${API_BASE}/banis/${JAAP_SAHIB_BANI_ID}`;
        console.log('Fetching Jaap Sahib from:', url);

        const response = await fetch(url);

        if (!response.ok) {
          throw new Error(`Failed to fetch Jaap Sahib: HTTP ${response.status}`);
        }

        const data = await response.json();

        console.log('=== BANI API RESPONSE ===');
        console.log('Bani Info:', data.baniInfo);
        console.log('Total Verses:', data.verses?.length);

        if (!data.verses || data.verses.length === 0) {
          throw new Error('No verses found in API response');
        }

        // Log first and last verse for verification
        if (data.verses.length > 0) {
          console.log('First verse:', data.verses[0]);
          console.log('Last verse:', data.verses[data.verses.length - 1]);
        }

        // Hide loading
        baniLoading.style.display = 'none';

        // Update stats
        const baniName = data.baniInfo?.unicode || 'à¨œà¨¾à¨ªà© à¨¸à¨¾à¨¹à¨¿à¨¬';
        statsBar.innerHTML = `âœ“ ${escapeHtml(baniName)} â€¢ ${data.verses.length} verses â€¢ à¨¸à©à¨°à©€ à¨¦à¨¸à¨® à¨—à©à¨°à©°à¨¥ à¨¸à¨¾à¨¹à¨¿à¨¬ à¨œà©€`;
        statsBar.classList.add('visible');

        // Render verses
        renderVerses(data.verses);

        // Show content
        versesContainer.classList.add('visible');

      } catch (error) {
        console.error('Error loading Jaap Sahib:', error);
        baniLoading.style.display = 'none';
        baniError.style.display = 'flex';
        errorMessage.textContent = error.message;
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER VERSES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function renderVerses(verses) {
      if (!verses || verses.length === 0) {
        console.warn('No verses to render');
        return;
      }

      versesContainer.innerHTML = '';
      let currentHeader = null;
      let sectionCount = 0;

      verses.forEach((verseData, index) => {
        const verse = verseData.verse || verseData;

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EXTRACT GURMUKHI (Unicode)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let gurmukhi = '';
        if (verse.verse) {
          if (typeof verse.verse === 'string') {
            gurmukhi = verse.verse;
          } else if (typeof verse.verse === 'object') {
            gurmukhi = verse.verse.unicode || verse.verse.gurmukhi || '';
          }
        } else if (typeof verse === 'object') {
          gurmukhi = verse.unicode || verse.gurmukhi || '';
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EXTRACT TRANSLITERATION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let transliteration = '';
        const translit = verseData.transliteration || verse.transliteration;
        if (translit) {
          if (typeof translit === 'string') {
            transliteration = translit;
          } else if (typeof translit === 'object') {
            transliteration = translit.english || translit.en || translit.roman || translit.text || '';
          }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EXTRACT ENGLISH TRANSLATION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let englishTranslation = '';
        const translation = verseData.translation || verse.translation;
        if (translation) {
          if (typeof translation === 'string') {
            englishTranslation = translation;
          } else if (typeof translation === 'object') {
            const en = translation.en;
            if (en) {
              if (typeof en === 'string') {
                englishTranslation = en;
              } else if (typeof en === 'object') {
                englishTranslation = en.bdb || en.ms || en.ssk || '';
              }
            }
          }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EXTRACT PUNJABI TRANSLATION (Unicode)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        let punjabiTranslation = '';
        if (translation?.pu) {
          const pu = translation.pu;
          if (typeof pu === 'string') {
            punjabiTranslation = pu;
          } else if (typeof pu === 'object') {
            const sources = ['ss', 'bdb', 'ms', 'ft'];
            for (const src of sources) {
              if (pu[src]) {
                if (typeof pu[src] === 'string') {
                  punjabiTranslation = pu[src];
                  break;
                } else if (typeof pu[src] === 'object') {
                  punjabiTranslation = pu[src].unicode || pu[src].gurmukhi || '';
                  if (punjabiTranslation) break;
                }
              }
            }
          }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SECTION HEADERS (Chhant, Savaiyya, Dohra, etc.)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const header = verse.header || verseData.header;
        if (header && header !== currentHeader) {
          currentHeader = header;
          sectionCount++;

          const sectionHeader = document.createElement('div');
          sectionHeader.className = 'section-header';

          // Map header types to names
          let headerText = '';
          switch (header) {
            case 1:
              headerText = `à¨›à©°à¨¦ ${sectionCount} â€¢ Chhant ${sectionCount}`;
              break;
            case 2:
              headerText = 'à¨¸à¨µà©ˆà¨¯à¨¾ â€¢ Savaiyya';
              break;
            case 3:
              headerText = 'à¨¦à©‹à¨¹à¨°à¨¾ â€¢ Dohra';
              break;
            case 4:
              headerText = 'à¨šà©Œà¨ªà¨ˆ â€¢ Chaupai';
              break;
            case 5:
              headerText = 'à¨…à©œà¨¿à©±à¨² â€¢ Arill';
              break;
            case 6:
              headerText = 'à¨­à©à¨œà©°à¨— à¨ªà©à¨°à¨¯à¨¾à¨¤ â€¢ Bhujang Prayat';
              break;
            default:
              headerText = `Section ${sectionCount}`;
          }

          sectionHeader.innerHTML = `<h2>${headerText}</h2>`;
          versesContainer.appendChild(sectionHeader);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // CREATE VERSE ELEMENT
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const verseEl = document.createElement('div');
        verseEl.className = 'verse';
        verseEl.setAttribute('data-verse-id', verse.verseId || verseData.verseId || index);

        verseEl.innerHTML = `
          <div class="verse__gurmukhi ${showGurmukhi ? '' : 'hidden'}">${escapeHtml(gurmukhi)}</div>
          <div class="verse__transliteration ${showTransliteration ? '' : 'hidden'}">${escapeHtml(transliteration)}</div>
          <div class="verse__translation ${showTranslation ? '' : 'hidden'}">${escapeHtml(englishTranslation)}</div>
          <div class="verse__punjabi ${showPunjabi ? '' : 'hidden'}">${escapeHtml(punjabiTranslation)}</div>
        `;

        versesContainer.appendChild(verseEl);
      });

      console.log(`âœ“ Rendered ${verses.length} verses`);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TOGGLE VISIBILITY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function toggleVisibility(className, show) {
      document.querySelectorAll(`.${className}`).forEach(el => {
        el.classList.toggle('hidden', !show);
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SETUP TOGGLE CONTROLS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function setupToggles() {
      const toggleGurmukhiBtn = document.getElementById('toggleGurmukhi');
      if (toggleGurmukhiBtn) {
        toggleGurmukhiBtn.addEventListener('click', function() {
          showGurmukhi = !showGurmukhi;
          this.dataset.active = showGurmukhi;
          toggleVisibility('verse__gurmukhi', showGurmukhi);
          savePreferences();
        });
      }

      const toggleTransliterationBtn = document.getElementById('toggleTransliteration');
      if (toggleTransliterationBtn) {
        toggleTransliterationBtn.addEventListener('click', function() {
          showTransliteration = !showTransliteration;
          this.dataset.active = showTransliteration;
          toggleVisibility('verse__transliteration', showTransliteration);
          savePreferences();
        });
      }

      const toggleTranslationBtn = document.getElementById('toggleTranslation');
      if (toggleTranslationBtn) {
        toggleTranslationBtn.addEventListener('click', function() {
          showTranslation = !showTranslation;
          this.dataset.active = showTranslation;
          toggleVisibility('verse__translation', showTranslation);
          savePreferences();
        });
      }

      const togglePunjabiBtn = document.getElementById('togglePunjabi');
      if (togglePunjabiBtn) {
        togglePunjabiBtn.addEventListener('click', function() {
          showPunjabi = !showPunjabi;
          this.dataset.active = showPunjabi;
          toggleVisibility('verse__punjabi', showPunjabi);
          savePreferences();
        });
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SCROLL TO TOP BUTTON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function setupScrollToTop() {
      if (!scrollTopBtn) return;

      window.addEventListener('scroll', () => {
        if (window.scrollY > 500) {
          scrollTopBtn.classList.add('visible');
        } else {
          scrollTopBtn.classList.remove('visible');
        }
      });

      scrollTopBtn.addEventListener('click', () => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RETRY BUTTON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function setupRetryButton() {
      if (retryBtn) {
        retryBtn.addEventListener('click', () => {
          loadBani();
        });
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOCAL STORAGE: SAVE/LOAD PREFERENCES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function savePreferences() {
      const prefs = {
        showGurmukhi,
        showTransliteration,
        showTranslation,
        showPunjabi
      };
      localStorage.setItem('baniPreferences', JSON.stringify(prefs));
    }

    function loadPreferences() {
      try {
        const saved = localStorage.getItem('baniPreferences');
        if (saved) {
          const prefs = JSON.parse(saved);
          showGurmukhi = prefs.showGurmukhi ?? true;
          showTransliteration = prefs.showTransliteration ?? true;
          showTranslation = prefs.showTranslation ?? true;
          showPunjabi = prefs.showPunjabi ?? false;

          // Update toggle button states
          const toggleGurmukhiBtn = document.getElementById('toggleGurmukhi');
          const toggleTransliterationBtn = document.getElementById('toggleTransliteration');
          const toggleTranslationBtn = document.getElementById('toggleTranslation');
          const togglePunjabiBtn = document.getElementById('togglePunjabi');

          if (toggleGurmukhiBtn) toggleGurmukhiBtn.dataset.active = showGurmukhi;
          if (toggleTransliterationBtn) toggleTransliterationBtn.dataset.active = showTransliteration;
          if (toggleTranslationBtn) toggleTranslationBtn.dataset.active = showTranslation;
          if (togglePunjabiBtn) togglePunjabiBtn.dataset.active = showPunjabi;
        }
      } catch (e) {
        console.warn('Could not load preferences:', e);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZE APPLICATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ™ Initializing Jaap Sahib Reader...');
      
      loadPreferences();
      setupToggles();
      setupScrollToTop();
      setupRetryButton();
      loadBani();
    });
  </script>

  <!-- Settings Panel Script (Keep this) -->
  <script src="bani-setting-panel.js"></script>
</body>
</html>